<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <title>Screen Viewer</title>
  <style>
    /* Existing styles... */
    @media (max-width:480px) {
      #remoteVideo { max-height: 50vh; }
      .container { padding: 15px; }
    }
  </style>
</head>
<body>
<div class="container">
  <h2>ðŸ“± Screen Viewer</h2>
  <p class="subtitle">Mobile & Desktop Friendly<br>iOS: Use Safari | Android: Use Chrome</p>
  
  <div class="input-container">
    <input type="text" id="sessionInput" placeholder="ABCDEF" maxlength="6" autocomplete="off" inputmode="text">
    <button id="joinBtn">ðŸ”— Connect</button>
  </div>

  <div class="device-info" id="deviceInfo">
    Optimized for mobile viewing â€¢ Audio automatically muted
  </div>

  <div class="error-message" id="errorMessage"></div>
  <div class="ice-status" id="iceStatus"></div>

  <div class="loading" id="loading">
    <div class="loading-spinner"></div>
    <p id="loadingText">Connecting via TURN servers... <span id="retryCount">0</span>/5</p>
  </div>

  <div class="video-container" id="videoContainer">
    <div class="status-bar" id="statusBar">
      <div class="status-dot connecting" id="statusDot"></div>
      <span id="statusText">Connecting...</span>
    </div>
    <div class="play-prompt" id="playPrompt">Tap to start video playback</div>
    <video id="remoteVideo" playsinline muted webkit-playsinline controls></video>
  </div>

  <div class="controls" id="controls" style="display:none;">
    <button class="disconnect-btn" id="disconnectBtn">Disconnect</button>
    <button class="disconnect-btn" id="toggleIceBtn" style="background:#6c757d;">Show ICE</button>
    <button class="disconnect-btn" id="fullscreenBtn" style="background:#007bff;">Fullscreen</button>
    <button class="disconnect-btn" id="suggestFullscreenBtn" style="background:#17a2b8;">Suggest Fullscreen</button>
  </div>
</div>

<script type="module">
import { db } from "./firebase-config.js";
import { ref, get, set, push, onChildAdded, off } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

// Existing variables and pcConfig...

function showLoading(show) {
  loading.style.display = show ? 'block' : 'none';
  joinBtn.disabled = show;
  joinBtn.textContent = show ? 'Connecting...' : 'ðŸ”— Connect';
  if (show) document.getElementById('retryCount').textContent = reconnectAttempts;
}

document.getElementById('suggestFullscreenBtn').onclick = () => {
  if (remoteVideo.requestFullscreen) {
    alert('Tap the video, then use the Fullscreen button for best view.');
  }
};

// Existing functions with bitrate control in ontrack...

if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('/sw.js').then(() => logIce('Service Worker registered')).catch(e => logIce(`Service Worker error: ${e.message}`));
}

// Rest of the script...
</script>
<!--Start of Tawk.to Script-->
<script type="text/javascript">
var Tawk_API=Tawk_API||{}, Tawk_LoadStart=new Date();
(function(){
var s1=document.createElement("script"),s0=document.getElementsByTagName("script")[0];
s1.async=true;
s1.src='https://embed.tawk.to/689782258b3b22192a593919/1j27t8oof';
s1.charset='UTF-8';
s1.setAttribute('crossorigin','*');
s0.parentNode.insertBefore(s1,s0);
})();
</script>
<!--End of Tawk.to Script-->
</body>
</html>
